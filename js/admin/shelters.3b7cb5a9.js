import{a as H}from"../vue-router/vue-router.4c3628b0.js";import{a as C}from"../../assets/index.83f5e590.js";import{S as b}from"../sweetalert2/sweetalert2.1f0830c9.js";import{f as J,N as O,G as K,p as P,E as Q,_ as W,m as X,v as Y,F as Z,k as x,n as ee,C as le}from"../naive-ui/naive-ui.0480605f.js";import{C as te}from"../@vicons/@vicons.3bd31fbf.js";import{r as f,L as T,m as ae,o as N,c as q,a0 as a,$ as s,a as i,R as _,J as w,b as U,F as ne,a2 as oe,a1 as z}from"../@vue/@vue.c9127f92.js";import"../vue3-img-input/vue3-img-input.a69b1d83.js";import"../pinia/pinia.0c8f4fc9.js";import"../axios/axios.1b9c812f.js";import"../validator/validator.ef9d5ed1.js";import"../date-fns/date-fns.1f5dea99.js";import"../pinia-plugin-persistedstate/pinia-plugin-persistedstate.48d55140.js";import"../seemly/seemly.86066edd.js";import"../vueuc/vueuc.d8419652.js";import"../evtd/evtd.a75b731f.js";import"../@css-render/@css-render.3e3ee87d.js";import"../vooks/vooks.f5d34b69.js";import"../vdirs/vdirs.89d68ee3.js";import"../@juggle/@juggle.9b9a42e3.js";import"../css-render/css-render.07ec946e.js";import"../@emotion/@emotion.64dbc332.js";import"../lodash-es/lodash-es.548c4e67.js";import"../treemate/treemate.525a187a.js";import"../async-validator/async-validator.21881447.js";const se={id:"admin-shelters"},pe={class:"table"},ue=i("thead",null,[i("tr",null,[i("th",null,"\u6392\u5E8F"),i("th",null,"\u6536\u5BB9\u6240\u5716\u7247"),i("th",null,"\u6536\u5BB9\u6240\u540D\u7A31"),i("th",null,"\u7DE8\u8F2F")])],-1),Ee={__name:"shelters",setup(ie){const m=f(!1),v=f([]),u=T([]),S=f(null),F=H(),g=f(1),k=f(0),c=f(12),L=ae(()=>{const t=(g.value-1)*c.value;return u.slice(t,t+c.value)}),e=T({_id:"",seq:"",img:[],place:"",cityName:"",tel:"",add:"",openTime:"",lon:"",lat:"",loading:!1}),$=t=>{let l=[],p=[];l=t.fileList.map(o=>o.url).filter(o=>o!==null),p=t.fileList.map(o=>o.file).filter(o=>o!==null),e.img=[...l,...p]},B=t=>{v.value.length=0,e._id=u[t]._id,e.seq=u[t].seq,e.img=u[t].img,e.place=u[t].place,e.cityName=u[t].cityName,e.tel=u[t].tel,e.add=u[t].add,e.openTime=u[t].openTime,e.lon=u[t].lon,e.lat=u[t].lat,e.valid=!1,e.loading=!1,v.value.push(...e.img.map((l,p)=>({id:p.toString(),name:p.toString(),status:"finished",url:l}))),m.value=!m.value},D=()=>{m.value=!1},E=async()=>{var l,p;const t=new FormData;t.append("seq",e.seq),e.img.length>=1&&e.img.forEach(o=>{t.append("img",o)}),t.append("place",e.place),t.append("cityName",e.cityName),t.append("tel",e.tel),t.append("add",e.add),t.append("openTime",e.openTime),t.append("lon",e.lon),t.append("lat",e.lat);try{const{data:o}=await C.patch("/shelters/"+e._id,t);u[e.idx]=o.result,b.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),F.go()}catch(o){console.log(o),b.fire({icon:"error",title:"\u5931\u6557",text:((p=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:p.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1,m.value=!1};return(async()=>{var t,l;try{const{data:p}=await C.get("/shelters");u.push(...p.result),u.sort((o,h)=>Number(o.seq)-Number(h.seq)),k.value=Math.ceil(u.length/c.value)}catch(p){b.fire({icon:"error",title:"\u5931\u6557",text:((l=(t=p==null?void 0:p.response)==null?void 0:t.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,l)=>{const p=J,o=le,h=O,y=W,R=K,V=P,d=X,r=Y,A=Z,I=x,M=ee,j=Q;return N(),q("div",se,[a(p,null,{default:s(()=>[U("\u6536\u5BB9\u6240\u8CC7\u6599\u7BA1\u7406")]),_:1}),i("div",pe,[a(R,{"single-line":!1,size:"large",striped:""},{default:s(()=>[ue,i("tbody",null,[(N(!0),q(ne,null,oe(_(L),(n,G)=>(N(),q("tr",{key:n._id},[i("td",null,z(n.seq),1),i("td",null,[a(o,{width:"150",src:n.img[0]},null,8,["src"])]),i("td",null,z(n.place),1),i("td",null,[a(y,{quaternary:"",circle:"",onClick:re=>B(G)},{icon:s(()=>[a(h,null,{default:s(()=>[a(_(te))]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),a(V,{page:_(g),"onUpdate:page":l[0]||(l[0]=n=>w(g)?g.value=n:null),"page-size":_(c),"onUpdate:page-size":l[1]||(l[1]=n=>w(c)?c.value=n:null),"page-count":_(k),"show-size-picker":"","page-sizes":[12]},null,8,["page","page-size","page-count"]),a(j,{show:_(m),"onUpdate:show":l[12]||(l[12]=n=>w(m)?m.value=n:null),preset:"card",title:"\u6536\u5BB9\u6240\u8CC7\u6599","trap-focus":!1},{default:s(()=>[a(M,{ref_key:"valid",ref:S,model:e,"label-placement":"left"},{default:s(()=>[a(r,{label:"\u6392\u5E8F: ",path:"seq"},{default:s(()=>[a(d,{value:e.seq,"onUpdate:value":l[2]||(l[2]=n=>e.seq=n),placeholder:"\u4FEE\u6539\u6392\u5E8F"},null,8,["value"])]),_:1}),a(r,{label:"\u6536\u5BB9\u6240\u540D\u7A31: ",path:"place"},{default:s(()=>[a(d,{value:e.place,"onUpdate:value":l[3]||(l[3]=n=>e.place=n),placeholder:"\u4FEE\u6539\u6536\u5BB9\u6240\u540D\u7A31"},null,8,["value"])]),_:1}),a(r,{label:"\u6240\u5728\u7E23\u5E02: ",path:"cityName"},{default:s(()=>[a(d,{value:e.cityName,"onUpdate:value":l[4]||(l[4]=n=>e.cityName=n),placeholder:"\u4FEE\u6539\u6240\u5728\u7E23\u5E02"},null,8,["value"])]),_:1}),a(r,{label:"\u96FB\u8A71: ",path:"tel"},{default:s(()=>[a(d,{value:e.tel,"onUpdate:value":l[5]||(l[5]=n=>e.tel=n),placeholder:"\u4FEE\u6539\u96FB\u8A71"},null,8,["value"])]),_:1}),a(r,{label:"\u5730\u5740: ",path:"add"},{default:s(()=>[a(d,{value:e.add,"onUpdate:value":l[6]||(l[6]=n=>e.add=n),placeholder:"\u4FEE\u6539\u5730\u5740"},null,8,["value"])]),_:1}),a(r,{label:"\u958B\u653E\u6642\u9593: ",path:"openTime"},{default:s(()=>[a(d,{value:e.openTime,"onUpdate:value":l[7]||(l[7]=n=>e.openTime=n),placeholder:"\u4FEE\u6539\u958B\u653E\u6642\u9593"},null,8,["value"])]),_:1}),a(r,{label:"\u7D93\u5EA6: ",path:"lon"},{default:s(()=>[a(d,{value:e.lon,"onUpdate:value":l[8]||(l[8]=n=>e.lon=n),placeholder:"\u4FEE\u6539\u7D93\u5EA6"},null,8,["value"])]),_:1}),a(r,{label:"\u7DEF\u5EA6: ",path:"lat"},{default:s(()=>[a(d,{value:e.lat,"onUpdate:value":l[9]||(l[9]=n=>e.lat=n),placeholder:"\u4FEE\u6539\u7DEF\u5EA6"},null,8,["value"])]),_:1}),a(r,{label:"\u65B0\u589E\u7167\u7247: ",path:"img"},{default:s(()=>[a(A,{"list-type":"image-card",value:e.img,"onUpdate:value":l[10]||(l[10]=n=>e.img=n),"default-file-list":_(v),onChange:$},null,8,["value","default-file-list"])]),_:1}),a(r,null,{default:s(()=>[a(I,null,{default:s(()=>[a(y,{disabled:e.loading,quaternary:"",type:"submit",onClick:E},{default:s(()=>[U(" \u9001\u51FA ")]),_:1},8,["disabled"]),a(y,{disabled:e.loading,quaternary:"",onClick:l[11]||(l[11]=n=>D())},{default:s(()=>[U(" \u53D6\u6D88 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}};export{Ee as default};
