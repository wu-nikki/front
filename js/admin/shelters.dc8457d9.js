import{a as j}from"../vue-router/vue-router.4c3628b0.js";import{a as x}from"../../assets/index.28f8f4e0.js";import{S as b}from"../sweetalert2/sweetalert2.1f0830c9.js";import{f as G,N as H,G as J,p as O,E as K,_ as P,m as Q,v as W,F as X,k as Y,n as Z,C as ee}from"../naive-ui/naive-ui.0480605f.js";import{C as le}from"../@vicons/@vicons.3bd31fbf.js";import{r as f,L as C,m as te,o as N,c as q,a0 as t,$ as s,a as u,R as _,J as w,b as U,F as ae,a2 as ne,a1 as T}from"../@vue/@vue.c9127f92.js";import"../vue3-img-input/vue3-img-input.a69b1d83.js";import"../pinia/pinia.0c8f4fc9.js";import"../axios/axios.1b9c812f.js";import"../validator/validator.ef9d5ed1.js";import"../date-fns/date-fns.1f5dea99.js";import"../pinia-plugin-persistedstate/pinia-plugin-persistedstate.48d55140.js";import"../seemly/seemly.86066edd.js";import"../vueuc/vueuc.d8419652.js";import"../evtd/evtd.a75b731f.js";import"../@css-render/@css-render.3e3ee87d.js";import"../vooks/vooks.f5d34b69.js";import"../vdirs/vdirs.89d68ee3.js";import"../@juggle/@juggle.9b9a42e3.js";import"../css-render/css-render.07ec946e.js";import"../@emotion/@emotion.64dbc332.js";import"../lodash-es/lodash-es.548c4e67.js";import"../treemate/treemate.525a187a.js";import"../async-validator/async-validator.21881447.js";const oe={id:"admin-shelters"},se={class:"table"},ie=u("thead",null,[u("tr",null,[u("th",null,"\u6392\u5E8F"),u("th",null,"\u6536\u5BB9\u6240\u5716\u7247"),u("th",null,"\u6536\u5BB9\u6240\u540D\u7A31"),u("th",null,"\u7DE8\u8F2F")])],-1),De={__name:"shelters",setup(pe){const m=f(!1),v=f([]),p=C([]),z=f(null),S=j(),g=f(1),k=f(0),c=f(12),F=te(()=>{const o=(g.value-1)*c.value;return p.slice(o,o+c.value)}),e=C({_id:"",seq:"",img:[],place:"",cityName:"",tel:"",add:"",openTime:"",lon:"",lat:"",loading:!1}),L=o=>{let l=[],i=[];l=o.fileList.map(n=>n.url).filter(n=>n!==null),i=o.fileList.map(n=>n.file).filter(n=>n!==null),e.img=[...l,...i]},$=o=>{const l=p.findIndex(i=>i._id===o);v.value.length=0,e._id=p[l]._id,e.seq=p[l].seq,e.img=p[l].img,e.place=p[l].place,e.cityName=p[l].cityName,e.tel=p[l].tel,e.add=p[l].add,e.openTime=p[l].openTime,e.lon=p[l].lon,e.lat=p[l].lat,e.valid=!1,e.loading=!1,v.value.push(...e.img.map((i,n)=>({id:n.toString(),name:n.toString(),status:"finished",url:i}))),m.value=!m.value},B=()=>{m.value=!1},D=async()=>{var l,i;const o=new FormData;o.append("seq",e.seq),e.img.length>=1&&e.img.forEach(n=>{o.append("img",n)}),o.append("place",e.place),o.append("cityName",e.cityName),o.append("tel",e.tel),o.append("add",e.add),o.append("openTime",e.openTime),o.append("lon",e.lon),o.append("lat",e.lat);try{const{data:n}=await x.patch("/shelters/"+e._id,o);p[e.idx]=n.result,b.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),S.go()}catch(n){console.log(n),b.fire({icon:"error",title:"\u5931\u6557",text:((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1,m.value=!1};return(async()=>{var o,l;try{const{data:i}=await x.get("/shelters");p.push(...i.result),p.sort((n,h)=>Number(n.seq)-Number(h.seq)),k.value=Math.ceil(p.length/c.value)}catch(i){b.fire({icon:"error",title:"\u5931\u6557",text:((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(o,l)=>{const i=G,n=ee,h=H,y=P,E=J,I=O,r=Q,d=W,R=X,V=Y,A=Z,M=K;return N(),q("div",oe,[t(i,null,{default:s(()=>[U("\u6536\u5BB9\u6240\u8CC7\u6599\u7BA1\u7406")]),_:1}),u("div",se,[t(E,{"single-line":!1,size:"large",striped:""},{default:s(()=>[ie,u("tbody",null,[(N(!0),q(ae,null,ne(_(F),(a,ue)=>(N(),q("tr",{key:a._id},[u("td",null,T(a.seq),1),u("td",null,[t(n,{width:"150",src:a.img[0]},null,8,["src"])]),u("td",null,T(a.place),1),u("td",null,[t(y,{quaternary:"",circle:"",onClick:de=>$(a._id)},{icon:s(()=>[t(h,null,{default:s(()=>[t(_(le))]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),t(I,{page:_(g),"onUpdate:page":l[0]||(l[0]=a=>w(g)?g.value=a:null),"page-size":_(c),"onUpdate:page-size":l[1]||(l[1]=a=>w(c)?c.value=a:null),"page-count":_(k),"show-size-picker":"","page-sizes":[12]},null,8,["page","page-size","page-count"]),t(M,{show:_(m),"onUpdate:show":l[12]||(l[12]=a=>w(m)?m.value=a:null),preset:"card",title:"\u6536\u5BB9\u6240\u8CC7\u6599","trap-focus":!1},{default:s(()=>[t(A,{ref_key:"valid",ref:z,model:e,"label-placement":"left"},{default:s(()=>[t(d,{label:"\u6392\u5E8F: ",path:"seq"},{default:s(()=>[t(r,{value:e.seq,"onUpdate:value":l[2]||(l[2]=a=>e.seq=a),placeholder:"\u4FEE\u6539\u6392\u5E8F"},null,8,["value"])]),_:1}),t(d,{label:"\u6536\u5BB9\u6240\u540D\u7A31: ",path:"place"},{default:s(()=>[t(r,{value:e.place,"onUpdate:value":l[3]||(l[3]=a=>e.place=a),placeholder:"\u4FEE\u6539\u6536\u5BB9\u6240\u540D\u7A31"},null,8,["value"])]),_:1}),t(d,{label:"\u6240\u5728\u7E23\u5E02: ",path:"cityName"},{default:s(()=>[t(r,{value:e.cityName,"onUpdate:value":l[4]||(l[4]=a=>e.cityName=a),placeholder:"\u4FEE\u6539\u6240\u5728\u7E23\u5E02"},null,8,["value"])]),_:1}),t(d,{label:"\u96FB\u8A71: ",path:"tel"},{default:s(()=>[t(r,{value:e.tel,"onUpdate:value":l[5]||(l[5]=a=>e.tel=a),placeholder:"\u4FEE\u6539\u96FB\u8A71"},null,8,["value"])]),_:1}),t(d,{label:"\u5730\u5740: ",path:"add"},{default:s(()=>[t(r,{value:e.add,"onUpdate:value":l[6]||(l[6]=a=>e.add=a),placeholder:"\u4FEE\u6539\u5730\u5740"},null,8,["value"])]),_:1}),t(d,{label:"\u958B\u653E\u6642\u9593: ",path:"openTime"},{default:s(()=>[t(r,{value:e.openTime,"onUpdate:value":l[7]||(l[7]=a=>e.openTime=a),placeholder:"\u4FEE\u6539\u958B\u653E\u6642\u9593"},null,8,["value"])]),_:1}),t(d,{label:"\u7D93\u5EA6: ",path:"lon"},{default:s(()=>[t(r,{value:e.lon,"onUpdate:value":l[8]||(l[8]=a=>e.lon=a),placeholder:"\u4FEE\u6539\u7D93\u5EA6"},null,8,["value"])]),_:1}),t(d,{label:"\u7DEF\u5EA6: ",path:"lat"},{default:s(()=>[t(r,{value:e.lat,"onUpdate:value":l[9]||(l[9]=a=>e.lat=a),placeholder:"\u4FEE\u6539\u7DEF\u5EA6"},null,8,["value"])]),_:1}),t(d,{label:"\u65B0\u589E\u7167\u7247: ",path:"img"},{default:s(()=>[t(R,{"list-type":"image-card",value:e.img,"onUpdate:value":l[10]||(l[10]=a=>e.img=a),"default-file-list":_(v),onChange:L},null,8,["value","default-file-list"])]),_:1}),t(d,null,{default:s(()=>[t(V,null,{default:s(()=>[t(y,{disabled:e.loading,quaternary:"",type:"submit",onClick:D},{default:s(()=>[U(" \u9001\u51FA ")]),_:1},8,["disabled"]),t(y,{disabled:e.loading,quaternary:"",onClick:l[11]||(l[11]=a=>B())},{default:s(()=>[U(" \u53D6\u6D88 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}};export{De as default};
